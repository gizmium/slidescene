!function s(r,h,a){function l(n,t){if(!h[n]){if(!r[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(u)return u(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var i=h[n]={exports:{}};r[n][0].call(i.exports,function(t){return l(r[n][1][t]||t)},i,i.exports,s,r,h,a)}return h[n].exports}for(var u="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({1:[function(o,t,n){!function(t){"use strict";var n=t.dom||o("./dom.js"),e=t.Main||o("./components/main.js");t.main=new e({element:n.body()})}(this.app||(this.app={}))},{"./components/main.js":4,"./dom.js":9}],2:[function(i,r,t){!function(t){"use strict";var n,e=i("jcore"),s=t.dom||i("../dom.js"),o=e.Component.inherits(function(){this.isActive=this.prop(!1),this.disabled=this.prop(!1),this.draggable=new o.Draggable(this)});o.prototype.oninit=function(){this.draggable.enable()},o.prototype.onredraw=function(){this.redrawBy("isActive",function(t){s.toggleClass(this.element(),"active",t)}),this.redrawBy("disabled",function(t){s.toggleClass(this.element(),"disabled",t)})},o.Draggable=((n=e.Draggable.inherits()).prototype.onstart=function(t,n,e,o,i){i.target=s.target(o),s.cancel(o),t.isActive(!0)},n.prototype.onmove=function(t,n,e,o,i){t.isActive(s.target(o)===i.target)},n.prototype.onend=function(t,n,e,o,i){t.isActive(!1),s.target(o)===i.target&&t.emit("tap")},n),void 0!==r&&r.exports?r.exports=o:t.Button=o}(this.app||(this.app={}))},{"../dom.js":9,jcore:void 0}],3:[function(h,a,t){!function(t){"use strict";var n,e=h("jcore"),o=t.helper||h("../helper.js"),s=t.dom||h("../dom.js"),i=t.Panel||h("./panel.js"),r=e.Component.inherits(function(){this.panels=[],this.medal=this.prop(""),this.sound=this.prop(""),this.needsNewPanels=this.prop(!0),this.moveWithAnimation=this.prop(0),this.draggable=new r.Draggable(this)});r.prototype.firstPanel=function(){return o.min(this.panels,function(t){return t.visible()?t.top():1/0})},r.prototype.lastPanel=function(){return o.max(this.panels,function(t){return t.visible()?t.bottom():-1/0})},r.prototype.panelFromTop=function(n){return o.find(this.panels,function(t){return t.top()<=n&&t.bottom()>n&&t.visible()})},r.prototype.outsidePanels=function(){return this.panels.filter(function(t){return t.bottom()<=0})},r.prototype.needsNextPanel=function(t){return!(t.bottom()>s.offsetHeight(this.element())+this.firstPanel().height())&&!!t.next()},r.prototype.currentSound=function(){var t=this.firstPanel();return t?t.sound():this.sound()},r.prototype.data=function(){return{medal:this.medal(),panels:this.panels.map(function(t){return{top:t.top(),visible:t.visible(),url:t.url(),medal:t.medal(),previous:this.panels.indexOf(t.previous)}}.bind(this))}},r.prototype.load=function(){var t=s.load("data",null);return(t?this.loadData(t):this.loadDefault()).then(function(){this.changeSound(this.currentSound()),this.save(),this.redraw(),this.on("animationend",this.onanimationend.bind(this)),this.draggable.enable()}.bind(this))},r.prototype.loadDefault=function(){return this.loadRootPanel().then(function(t){return this.changeMedal(t.medal()),t.visible(!0),this.loadNewPanels().then(function(){this.removePanel(t)}.bind(this))}.bind(this))},r.prototype.loadData=function(e){return this.changeMedal(e.medal),e.panels.reduce(function(t,n){return t.then(function(){return this.loadPanel({top:n.top,previous:null,url:n.url,medal:n.medal}).then(function(t){t.visible(n.visible)})}.bind(this))}.bind(this),Promise.resolve()).then(function(){this.panels.forEach(function(t,n){n=e.panels[n].previous;t.previous=this.panels[n]||null}.bind(this))}.bind(this))},r.prototype.loadPanel=function(t){var n=new i({top:t.top,previous:t.previous});return n.parentElement(this.element()),n.redraw(),this.panels.push(n),n.load(t.url,t.medal).then(function(t){return t.on("animationend",this.onpanelanimationend.bind(this)),t}.bind(this))},r.prototype.loadRootPanel=function(){return this.loadPanel({top:-24,previous:null,url:"scenes/index.html",medal:""})},r.prototype.loadNextPanel=function(t){return this.needsNextPanel(t)?this.loadPanel({top:t.bottom(),previous:t,url:"scenes/"+t.next()+".html",medal:this.medal()}).then(function(t){if(t.medal()===this.medal())return t.visible(!0),this.loadNextPanel(this.lastPanel())}.bind(this)):Promise.resolve()},r.prototype.loadNewPanels=function(){if(!this.needsNewPanels())return Promise.resolve();var t=this.lastPanel();return t?(this.needsNewPanels(!1),this.loadNextPanel(t).then(function(){this.needsNewPanels(!0)}.bind(this))):Promise.resolve()},r.prototype.showNextPanel=function(n){var t=o.find(this.panels,function(t){return t.previous===n&&t.medal()===n.medal()});t&&(t.visible(!0),this.showNextPanel(t))},r.prototype.hideNextPanel=function(n){this.panels.forEach(function(t){t.bottom()>n.bottom()&&t.visible()&&t.visible(!1)})},r.prototype.removePanel=function(n){n.removeAllListeners(),n.parentElement(null),this.panels.forEach(function(t){t.previous===n&&(t.previous=null)}),o.remove(this.panels,n)},r.prototype.removePanels=function(t){t.forEach(function(t){this.removePanel(t)}.bind(this))},r.prototype.move=function(n){var t=this.firstPanel().top();0<t+n&&(n=-t),this.panels.forEach(function(t){t.top(t.top()+n)})},r.prototype.moveUp=function(){var t=this.panelFromTop(0);t&&this.moveWithAnimation(-t.top())},r.prototype.moveDown=function(){var t=this.panelFromTop(0);t&&t!==this.lastPanel()&&this.moveWithAnimation(-t.bottom())},r.prototype.moveLeft=function(){var t=this.panelFromTop(0);t&&t.canScrollToLeft()&&t.scrollToLeft()},r.prototype.moveRight=function(){var t=this.panelFromTop(0);t&&t.canScrollToRight()&&t.scrollToRight()},r.prototype.changeMedal=function(t){t!==this.medal()&&(this.medal(t),this.emit("medal",t))},r.prototype.changeSound=function(t){t!==this.sound()&&(this.sound(t),this.emit("sound",t))},r.prototype.save=function(){s.save("data",this.data())},r.prototype.onredraw=function(){this.redrawBy("moveWithAnimation",function(t){if(0!==this.panels.length)if(0!==t){var n=(0<t?1:-1)*Math.min(Math.abs(t),24);this.panels.forEach(function(t){t.top(t.top()+n),t.redraw()}),setTimeout(this.moveWithAnimation.bind(this),0,t-n)}else setTimeout(this.emit.bind(this),0,"animationend")})},r.prototype.onanimationend=function(){var t=this.panelFromTop(0);t&&0===t.top()&&(this.removePanels(this.outsidePanels()),this.loadNewPanels().then(function(){this.changeSound(this.currentSound()),this.save()}.bind(this)))},r.prototype.onpanelanimationend=function(t){-1!==this.panels.indexOf(t)&&t.visible()&&(this.changeMedal(t.medal()),this.hideNextPanel(t),this.showNextPanel(t),this.loadNewPanels().then(function(){this.save()}.bind(this)))},r.Draggable=((n=e.Draggable.inherits()).prototype.onstart=function(t,n,e,o,i){s.cancel(o),i.dy=0,i.ddy=0,i.dx=0,i.ddx=0,i.lockY=!1,i.lockX=!1,i.panel=t.panelFromTop(e),t.moveWithAnimation(0),i.panel&&i.panel.scrollWithAnimation(0)},n.prototype.onmove=function(t,n,e,o,i){0!==t.panels.length&&(i.lockY||i.lockX||(i.lockY=24<=Math.abs(e)),i.lockY||i.lockX||(i.lockX=24<=Math.abs(n)),i.lockX||this.onmovey(t,n,e,o,i),!i.lockY&&i.panel&&this.onmovex(t,n,e,o,i))},n.prototype.onmovey=function(t,n,e,o,i){var s=e-i.dy;0!==s&&(i.dy=e,i.ddy=s,t.move(s))},n.prototype.onmovex=function(t,n,e,o,i){var s=n-i.dx;0!==s&&(i.dx=n,i.ddx=s,i.panel.scroll(s))},n.prototype.onend=function(t,n,e,o,i){0!==t.panels.length&&(this.onendy(t,n,e,o,i),i.panel&&this.onendx(t,n,e,o,i))},n.prototype.onendy=function(t,n,e,o,i){var s,r=t.panelFromTop(0),h=t.lastPanel();if(r&&r!==h){var a=r.top(),l=r.bottom();s=a<=-24&&24<=l?0<i.ddy?-a:-l:-a<l?-a:-l}else s=-h.top();0!==s||0===i.ddy?t.moveWithAnimation(s):t.onanimationend()},n.prototype.onendx=function(t,n,e,o,i){var s,r=i.panel,h=r.left(),a=r.right();0!=(s=h<=-24&&24<=a?0<i.ddx?-h:-a:-h<a?-h:-a)||0===i.ddx?r.scrollWithAnimation(s):t.onpanelanimationend(r)},n),void 0!==a&&a.exports?a.exports=r:t.Content=r}(this.app||(this.app={}))},{"../dom.js":9,"../helper.js":10,"./panel.js":7,jcore:void 0}],4:[function(d,f,t){!function(t){"use strict";var e,n,o,i,s,r=d("jcore"),h=t.dom||d("../dom.js"),a=t.Content||d("./content.js"),l=t.Medal||d("./medal.js"),u=t.MuteButton||d("./mute-button.js"),c=t.Sound||d("../controllers/sound.js"),p=r.Component.inherits(function(){this.disabled=this.prop(!0),this.sound=new c,this.content=new a({element:this.findElement(".content")}),this.medal=new l({element:this.findElement(".medal")}),this.muteButton=new u({element:this.findElement(".mute-button")})});p.prototype.unlockSound=function(){var t=function(){this.sound.unlock(function(){h.off(h.body(),"mousedown",t,!0)})}.bind(this);h.on(h.body(),"mousedown",t,!0)},p.prototype.oninit=function(){this.content.on("medal",this.onmedal.bind(this)),this.content.on("sound",this.onsound.bind(this)),this.muteButton.on("mute",this.onmute.bind(this)),this.muteButton.on("unmute",this.onunmute.bind(this)),h.supportsTouch()||this.unlockSound(),this.content.load().then(function(){h.on(this.element(),"keydown",this.onkeydown.bind(this)),h.on(this.element(),"wheel",this.onwheel.bind(this)),this.disabled(!1)}.bind(this))},p.prototype.onredraw=function(){this.redrawBy("disabled",function(t){h.toggleClass(this.element(),"disabled",t)})},p.prototype.onmedal=function(t){this.medal.change(t)},p.prototype.onsound=function(t){this.sound.change(t)},p.prototype.onmute=function(){this.sound.mute()},p.prototype.onunmute=function(){this.sound.unmute()},p.prototype.onkeydown=(e={37:"moveLeft",38:"moveUp",39:"moveRight",40:"moveDown"},function(t){var n=e[h.which(t)];n&&(h.cancel(t),this.content[n]())}),p.prototype.onwheel=(i=!(n={}),s=o=0,function(t){i||(this.content.draggable.onstart(this.content,0,-1,t,n),i=!0),o-=h.deltaY(t),this.content.draggable.onmove(this.content,0,o,t,n),s&&clearTimeout(s),s=setTimeout(function(){this.content.draggable.onend(this.content,0,o,t,n),i=!1,s=o=0}.bind(this),100)}),void 0!==f&&f.exports?f.exports=p:t.Main=p}(this.app||(this.app={}))},{"../controllers/sound.js":8,"../dom.js":9,"./content.js":3,"./medal.js":5,"./mute-button.js":6,jcore:void 0}],5:[function(o,s,t){!function(t){"use strict";var n=o("jcore"),i=t.dom||o("../dom.js"),e=n.Component.inherits(function(){this.name=this.prop("")});e.prototype.src=function(){return this.name()?"medals/"+this.name()+".svg":e.SRC_EMPTY},e.prototype.change=function(o){return new Promise(function(t,n){var e=i.children(this.element());this.name(o),i.once(e[0],"load",function(){if(this.name()&&o!==this.name())return n();i.once(this.element(),"transitionend",function(){if(this.name()&&o!==this.name())return n();i.append(this.element(),e[0]),i.attr(e[1],{src:this.src()}),i.css(this.element(),{"background-image":'url("'+this.src()+'")'}),t()}.bind(this)),i.toggleClass(e[0],"hide",!1),i.toggleClass(e[1],"hide",!0)}.bind(this)),i.attr(e[0],{src:this.src()})}.bind(this))},e.prototype.oninit=function(){var n=this.onfailed.bind(this);i.children(this.element()).forEach(function(t){i.on(t,"error",n),i.on(t,"abort",n)})},e.prototype.onfailed=function(t){this.name(""),i.attr(i.target(t),{src:this.src()})},e.SRC_EMPTY="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP49evXfwAJzgPuP0JMDwAAAABJRU5ErkJggg==",void 0!==s&&s.exports?s.exports=e:t.Medal=e}(this.app||(this.app={}))},{"../dom.js":9,jcore:void 0}],6:[function(s,r,t){!function(t){"use strict";var n=s("jcore"),e=t.dom||s("../dom.js"),o=t.Button||s("./button.js"),i=n.Component.inherits(function(t){this.states=["mute","unmute"],this.stateIndex=this.prop(0),this.button=new o({element:t.element})});i.prototype.state=function(){return this.states[this.stateIndex()]},i.prototype.toggle=function(){this.stateIndex((this.stateIndex()+1)%this.states.length)},i.prototype.oninit=function(){this.button.on("tap",this.ontap.bind(this))},i.prototype.onredraw=function(){this.redrawBy("state",function(t){e.data(this.element(),"state",t)})},i.prototype.ontap=function(){this.toggle(),this.emit(this.state())},void 0!==r&&r.exports?r.exports=i:t.MuteButton=i}(this.app||(this.app={}))},{"../dom.js":9,"./button.js":2,jcore:void 0}],7:[function(h,a,t){!function(t){"use strict";var n,e=h("jcore"),o=t.helper||h("../helper.js"),i=t.dom||h("../dom.js"),s=t.Button||h("./button.js"),r=e.Component.inherits(function(t){this.width=this.prop(624),this.top=this.prop(t.top),this.paddingTop=this.prop(12),this.paddingBottom=this.prop(12),this.visible=this.prop(!1),this.url=this.prop(""),this.content=new r.Content({element:this.findElement(".panel-content")}),this.leftButton=new s({element:this.findElement(".panel-button-left")}),this.rightButton=new s({element:this.findElement(".panel-button-right")}),this.previous=t.previous});r.prototype.height=function(){return this.paddingTop()+this.content.height()+this.paddingBottom()},r.prototype.bottom=function(){return this.top()+this.height()},r.prototype.left=function(){return-this.content.scrollLeft()%this.width()},r.prototype.right=function(){return this.left()+this.width()},r.prototype.medalIndex=function(){return Math.round(this.content.scrollLeft()/this.width())},r.prototype.medal=function(){return this.content.medal(this.medalIndex())},r.prototype.next=function(){return this.content.next(this.medalIndex())},r.prototype.sound=function(){return this.content.sound()},r.prototype.load=function(t,n){return this.url(t),this.content.load(t).then(function(){var t=n?this.content.indexOf(n):0;return this.content.scrollLeft(this.width()*t),this.onscroll(),this}.bind(this))},r.prototype.scroll=function(t){var n=o.clamp(this.content.scrollLeft()-t,0,this.content.width()-this.width());this.content.scrollLeft(n)},r.prototype.scrollWithAnimation=function(t){this.content.scrollWithAnimation(t)},r.prototype.canScrollToLeft=function(){return 0<this.content.scrollLeft()},r.prototype.canScrollToRight=function(){return this.content.scrollLeft()<this.content.width()-this.width()},r.prototype.scrollToLeft=function(){this.scrollWithAnimation(-this.left()||this.width())},r.prototype.scrollToRight=function(){this.scrollWithAnimation(-this.right()||-this.width())},r.prototype.render=function(){return i.render(r.HTML_TEXT)},r.prototype.onappend=function(){this.content.on("scroll",this.onscroll.bind(this)),this.content.on("animationend",this.onanimationend.bind(this)),this.leftButton.on("tap",this.onleft.bind(this)),this.rightButton.on("tap",this.onright.bind(this))},r.prototype.onremove=function(){this.content.removeAllListeners(),this.leftButton.removeAllListeners(),this.rightButton.removeAllListeners()},r.prototype.onredraw=function(){this.redrawBy("top",function(t){i.translateY(this.element(),t)}),this.redrawBy("paddingTop",function(t){i.css(this.element(),{"padding-top":t+"px"})}),this.redrawBy("paddingBottom",function(t){i.css(this.element(),{"padding-bottom":t+"px"})}),this.redrawBy("visible",function(t){i.toggleClass(this.element(),"hide",!t)})},r.prototype.onscroll=function(){this.leftButton.disabled(!this.canScrollToLeft()),this.rightButton.disabled(!this.canScrollToRight())},r.prototype.onanimationend=function(){this.content.scrollLeft()%this.width()==0&&this.emit("animationend",this)},r.prototype.onleft=function(){this.canScrollToLeft()&&setTimeout(this.scrollToLeft.bind(this),0)},r.prototype.onright=function(){this.canScrollToRight()&&setTimeout(this.scrollToRight.bind(this),0)},r.HTML_TEXT=['<div class="panel">','<iframe class="panel-content" scrolling="no"></iframe>','<div class="panel-button-left panel-button"></div>','<div class="panel-button-right panel-button"></div>',"</div>"].join(""),r.Content=((n=e.Component.inherits(function(){this.width=this.prop(0),this.height=this.prop(0),this.scrollLeft=this.prop(-1),this.scrollWithAnimation=this.prop(0),this.module=null})).prototype.indexOf=function(t){return this.module?this.module.medals.indexOf(t):-1},n.prototype.medal=function(t){return this.module?this.module.medals[t]:""},n.prototype.next=function(t){return this.module?this.module.nexts[t]:""},n.prototype.sound=function(){return this.module?this.module.sound:""},n.prototype.load=function(n){return new Promise(function(t){i.once(this.element(),"load",function(){t(i.contentWindow(this.element()).scene.exports)}.bind(this)),i.attr(this.element(),{src:n})}.bind(this)).then(function(t){this.width(i.contentWidth(this.element())),this.height(i.contentHeight(this.element())),this.redraw(),this.module=t}.bind(this))},n.prototype.onredraw=function(){this.redrawBy("width",function(t){i.css(this.element(),{width:t+"px"})}),this.redrawBy("height",function(t){i.css(this.element(),{height:t+"px"})}),this.redrawBy("scrollLeft",function(t){this.module&&this.onscroll(t)}),this.redrawBy("scrollWithAnimation",function(t){if(this.module)if(0!==t){var n=(0<t?1:-1)*Math.min(Math.abs(t),24);this.scrollLeft(this.scrollLeft()-n),this.onscroll(this.scrollLeft()),setTimeout(this.scrollWithAnimation.bind(this),0,t-n)}else setTimeout(this.emit.bind(this),0,"animationend")})},n.prototype.onscroll=function(t){i.translateX(this.element(),-t),this.module.onscroll(t),setTimeout(this.emit.bind(this),0,"scroll")},n),void 0!==a&&a.exports?a.exports=r:t.Panel=r}(this.app||(this.app={}))},{"../dom.js":9,"../helper.js":10,"./button.js":2,jcore:void 0}],8:[function(e,i,t){!function(t){"use strict";var o=e("howler"),n=function(){this.howl=null,this.muted=!0};n.prototype.create=function(t){return new o.Howl({src:["sounds/"+t+".mp3"],loop:!0,mute:this.muted})},n.prototype.fadeOut=function(){return new Promise(function(t){if(!this.howl)return t();this.howl.once("fade",function(){t()}),this.howl.fade(1,0,1e3)}.bind(this))},n.prototype.change=function(t){var n=this.howl;return this.fadeOut().then(function(){if(n!==this.howl)throw new Error('Failed to change sound to "'+t+'"');this.howl&&this.howl.unload(),t?(this.howl=this.create(t),this.howl.play()):this.howl=null}.bind(this))},n.prototype.mute=function(){this.muted=!0,this.howl&&this.howl.mute(!0)},n.prototype.unmute=function(){this.muted=!1,this.howl&&this.howl.mute(!1)},n.prototype.unlock=function(t){var n=o.Howler;if(n.ctx){n._scratchBuffer||(n._scratchBuffer=n.ctx.createBuffer(1,1,22050)),n._autoResume();var e=n.ctx.createBufferSource();e.buffer=n._scratchBuffer,e.connect(n.ctx.destination),void 0===e.start?e.noteOn(0):e.start(0),"function"==typeof n.ctx.resume&&n.ctx.resume(),e.onended=function(){e.disconnect(0),t()}}},void 0!==i&&i.exports?i.exports=n:t.Sound=n}(this.app||(this.app={}))},{howler:void 0}],9:[function(t,n,e){!function(t){"use strict";var s={body:function(){return document.body},render:function(t){var n=document.createRange().createContextualFragment(t).firstChild;return n.parentNode.removeChild(n),n},children:function(t){return Array.prototype.slice.call(t.children)},append:function(t,n){t.appendChild(n)},attr:function(n,e){Object.keys(e).forEach(function(t){n.setAttribute(t,e[t])})},css:function(t,n){var e=t.style;Object.keys(n).forEach(function(t){e[t]=n[t]})},toggleClass:function(t,n,e){e?t.classList.add(n):t.classList.remove(n)},data:function(t,n,e){t.dataset[n]=e},offsetHeight:function(t){return t.offsetHeight},transform:function(t,n){s.css(t,{transform:n,webkitTransform:n})},translateX:function(t,n){s.transform(t,"translateX("+n+"px)")},translateY:function(t,n){s.transform(t,"translateY("+n+"px)")},contentWindow:function(t){return t.contentWindow},contentWidth:function(t){return t.contentDocument.documentElement.scrollWidth},contentHeight:function(t){return t.contentDocument.documentElement.scrollHeight},on:function(t,n,e,o){t.addEventListener(n,e,!!o)},off:function(t,n,e,o){t.removeEventListener(n,e,!!o)},once:function(t,n,e,o){var i=function(){s.off(t,n,i,o),e.apply(null,arguments)};s.on(t,n,i,o)},supportsTouch:function(){return"ontouchstart"in window||"undefined"!=typeof DocumentTouch&&document instanceof DocumentTouch},changedTouch:function(t){return s.supportsTouch()&&"changedTouches"in t?t.changedTouches[0]:null},target:function(t){var n=s.changedTouch(t);return n?document.elementFromPoint(n.clientX,n.clientY):t.target},cancel:function(t){t.preventDefault()},which:function(t){return t.which},deltaY:function(t){return t.deltaY},load:function(t,n){return JSON.parse(sessionStorage.getItem(t))||n},save:function(t,n){sessionStorage.setItem(t,JSON.stringify(n))}};void 0!==n&&n.exports?n.exports=s:t.dom=s}(this.app||(this.app={}))},{}],10:[function(t,e,n){!function(t){"use strict";var n={clamp:function(t,n,e){return Math.min(Math.max(t,n),e)},remove:function(t,n){var e=t.indexOf(n);-1!==e&&t.splice(e,1)},find:function(t,n){for(var e=0,o=t.length;e<o;e++)if(n(t[e],e,t))return t[e];return null},max:function(t,n){for(var e=null,o=-1/0,i=0,s=t.length;i<s;i++){var r=n(t[i],i,t);o<r&&(e=t[i],o=r)}return e},min:function(t,n){for(var e=null,o=1/0,i=0,s=t.length;i<s;i++){var r=n(t[i],i,t);r<o&&(e=t[i],o=r)}return e}};void 0!==e&&e.exports?e.exports=n:t.helper=n}(this.app||(this.app={}))},{}]},{},[1]);